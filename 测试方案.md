# 测试方案

## 工具与分层
- 前端：Vitest + React Testing Library（单元/组件）+ Playwright（E2E）。
- 后端：Vitest（或Jest）+ Supertest（API）+ nock（外部服务模拟）。
- 数据库：testcontainers（Postgres隔离环境）+ Prisma 验证 + pgBench（性能）。
- 质量：ESLint + Prettier + TypeScript检查；覆盖率阈值：单元/组件≥80%，E2E≥70%。

## 测试策略
- 单元：纯函数与状态Store、筛选表达式解析、条件着色计算、权限判断等。
- 组件：
  - 侧边栏层级导航与分割线；入口（收集表/仪表盘/文档/文件夹）。
  - 标签页与视图菜单（重命名/复制/保护/删除）、保护视图抽屉悬停行为。
  - 工具栏：字段配置抽屉与编辑弹窗、筛选条件构建器、排序、行高、填色（24色、作用域）。
  - 网格：虚拟滚动渲染、编辑器（文本/数字/日期/单选/多选/人员/附件/公式占位）、表头菜单全集与约束。
  - Excel导入/导出：头部映射与错误提示。
- 集成：前端对Mock API（MSW）交互场景；后端路由+服务层+ORM；附件上传与校验；分享链接权限。
- E2E：
  - 登录→创建项目/任务/数据表→新建视图→字段编辑→筛选/排序/分页→填色→导出/导入→分享链接访问只读。
  - 并发协同：两客户端同时编辑、光标广播、评论创建；冲突策略验证。
- 性能：
  - 前端：1000行×100列渲染与滚动流畅度；交互响应时间（点击到渲染）。
  - 后端：分页/筛选/排序P95≤200ms；pgBench基准；全文检索与模糊查询耗时。

## 数据与环境
- 测试数据：固定种子（projects/tasks/tables/fields/records/views/users）；Excel样例；附件样例（Office类型）。
- 环境隔离：testcontainers每套用例独立数据库；文件存储使用临时目录；CI中启用Docker服务。

## CI/CD与门禁
- GitHub Actions：
  - 作业：lint→typecheck→unit/component→backend unit/integration→db container tests→e2e（带服务器与浏览器）→pgBench性能。
  - 缓存：pnpm、Prisma生成；工件：测试报告、覆盖率、E2E视频。
  - 门禁：覆盖率阈值、E2E关键用例必过、性能阈值；不达标阻断合并。

## 缺陷管理与报告
- 缺陷分级：阻断/高/中/低；SLA修复时间与回归测试。
- 报告：每迭代出具测试报告（覆盖率、用例通过率、性能结果、缺陷统计）。

## DoD（测试层面）
- 新功能具备：对应单元/组件/集成/E2E用例；覆盖率达标；CI全绿；文档与变更记录更新。

## 落地要求
- 每个小功能开发完成后：
  - 输出开发进度实际情况（完成项、偏差、阻塞）。
  - 运行并提交对应测试（含截图/视频证据）。
  - 在todolist中勾选已完成项并记录回归用例。