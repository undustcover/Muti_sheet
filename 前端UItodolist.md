# 前端 UI todolist

## 推进顺序
- 表头菜单与抽屉细化 → 条件引擎（筛选/填色） → 权限联动（保护视图） → 视觉细化 → 其他模块（收集表/仪表盘/文档/文件夹）

## 迭代 ToDo
- 迭代1：表头菜单与抽屉细化
  - [ ] 新增 `HeaderMenu` 组件（表头右侧三角）及菜单项：`编辑字段`、`编辑描述`、`整列填色`、`复制字段`、`隐藏字段`、`插入左/右`、`冻结至此字段`、`升序/降序`、`删除字段`
  - [ ] 将菜单状态与 `App.tsx` 的 `columnMeta` 关联，支持标题与类型更新，保留“首列不可删除/类型仅文本/日期/数字”的约束
  - [ ] 实现“冻结至此字段”：维护 `freezeCount`，将前 N 列设置 `position: sticky; left` 并计算 left 累积宽度
  - [ ] 为“隐藏字段”实现列可见性（不影响数据导出），提供“显示已隐藏字段”入口
  - [ ] DoD：每列可打开菜单并执行上述动作；表格渲染与交互正常，无控制台/终端错误

- 迭代2：条件引擎（筛选/填色）
  - [ ] 定义条件模型 `Condition = { fieldId, operator, value, scope }` 与操作符集合（等于/包含/大于/小于/为空/不为空/介于等）
  - [ ] 新增 `ConditionBuilder` 组件（用于工具栏“筛选”“填色”入口），支持保存/取消
  - [ ] 基于条件对 `table` 数据进行筛选（优先链式组合 AND/OR 简版），与 `@tanstack/react-table` 排序互不冲突
  - [ ] 填色规则：根据 `scope`（单元格/整行/整列）返回样式类名并应用到渲染节点；用 `zustand` 建立 `ColorRulesStore`
  - [ ] DoD：添加/编辑/删除规则即时生效；筛选与填色在大数据量下表现顺畅（虚拟滚动无异常）

- 迭代3：权限联动（保护视图）
  - [ ] 在 `ProtectDrawer` 三种模式下：`locked` 禁用字段编辑与结构变更；`personal` 限制非所有者的视图可见性；`public` 正常编辑
  - [ ] 引入 `currentUser` 模拟上下文与视图拥有者；工具栏与表头菜单按模式禁用/隐藏相关动作
  - [ ] 添加锁定指示与只读提示（工具栏/表头旁）
  - [ ] DoD：切换模式后权限即时生效；非所有者在 `personal` 模式看不到该视图

- 迭代4：视觉细化（美观一致）
  - [ ] 引入设计令牌（CSS变量）：`--color-primary`、`--radius`、`--shadow`、`--spacing`、`--font` 等并应用到 `Sidebar/Tabs/Toolbar/Drawer`
  - [ ] 优化标签页外观（更圆润、层次阴影、激活态边框与背景、过渡动画），为菜单与弹窗加统一的阴影与动效
  - [ ] 统一按钮样式、输入框状态（hover/focus/disabled），对齐飞书风格基线
  - [ ] DoD：整页视觉一致、轻量动效自然、无布局抖动

- 迭代5：模块占位增强
  - [ ] 收集表：表单字段列表、发布链接占位、简单提交预览
  - [ ] 仪表盘：卡片栅格、折线/柱状/饼图占位（假数据）
  - [ ] 文档：富文本编辑器占位（只读/编辑切换）
  - [ ] 文件夹：文件列表与预览框占位
  - [ ] DoD：侧边栏切换各模块均有基础原型，页面无报错

## 每日 ToDo
- 启动与健康检查
  - [ ] 执行 `pnpm run dev`（目录 `apps/web`），打开 `http://localhost:5173/`
  - [ ] 浏览器控制台无错误；终端无新错误日志；HMR 正常
- 开发与自测
  - [ ] 当日计划任务清单（从“迭代 ToDo”中选定 2–4 个）
  - [ ] 每个任务完成即执行功能验收（交互/权限/视觉），记录异常与改进点
- 稳定性与回归
  - [ ] 快速脚本自测：添加/编辑/排序/切换视图/保护视图/导入导出
  - [ ] 预览确认：主路径（侧边栏→数据表→页签→工具栏→表格）不报错

## 验收清单
- [ ] 表头菜单功能全覆盖，首列规则与冻结列可用
- [ ] 条件引擎可构建 ≥3 种常用规则并正确筛选与填色
- [ ] 保护视图权限约束落地，UI有只读/锁定提示
- [ ] 视觉统一且无明显违和；交互动效轻量自然
- [ ] Excel 导入/导出在新 UI 下流程通畅
- [ ] `http://localhost:5173/` 无错误日志；终端运行正常

## 风险控制
- 复杂交互分步落地：先打通数据模型与状态，再接入视觉与动效，避免“大而全”一次性改动
- 明确约束：首列不可删除、冻结列与 sticky 边界处理、筛选与排序的组合优先级
- 性能保障：每次引入条件/填色均校验虚拟滚动帧率与渲染成本；避免在单元格内创建重型组件
- 迭代内不做跨域改动：专注于当前迭代目标，超范围需求进入下一迭代 Backlog